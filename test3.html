<html>
<head>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
  <script src="lightgl.js"></script>
  <script src="csg.js"></script>
  <script src="openjscad.js"></script>
    
</head>
<body>
<a id='blahfoo' href='#'>download stl file</a>
<script type='text/javascript'>
$(document).ready(function() {


function generateStlFromJSCad(jscadscript, linkid) {
    var gProcessor = new OpenJsCad.Processor();
    gProcessor.setDebugging(false);
    gProcessor.setJsCad(jscadscript, "");
    var obj = OpenJsCad.parseJsCadScriptSync(jscadscript, {}, false);
    var blob = obj.fixTJunctions().toStlBinary();
    var windowURL=OpenJsCad.getWindowURL();
    var outputFileBlobUrl = windowURL.createObjectURL(blob)
    $("#"+linkid).attr("href",outputFileBlobUrl);
    $("#"+linkid).attr("download","obenjscad.stl");
    console.log("generated stl");
}

var text = $('#model').text();
generateStlFromJSCad(text, "blahfoo");
});
</script>
<script id='model' type='text/jscad'>
function main() {
  var cube = CSG.roundedCube({radius: 8, roundradius: 2, resolution: 10});
  var sphere = CSG.sphere({radius: 8, resolution: 10}).translate([5, 5, 5]);
  return cube.union(sphere);
}
</script>
</body>
</html>
